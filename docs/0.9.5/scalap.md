---
layout: manual
title: Field type deduction
headtitle: Field type deduction - 
---

When a Schema is created, Squeryl uses Java reflection to determine the
type of each database column.  
For certain parameterized types, like Option, the differences between
Scala and Java at the type level can make this challenging. While Scala
treats all types as Objects, Java does not and has special rules for  
“primitive” values such as int, long and boolean. Part of Java’s special
treatment of primitive’s excludes them from  
use as type parameters, therefore in Java this definition would not
compile:

<script type="syntaxhighlighter" class="brush: java">

<![CDATA[
scala.Option<int> anOptionalInt
]]>

</script>

While an analogous definition in Scala would compile:

<script type="syntaxhighlighter" class="brush: scala">

<![CDATA[
val anOptionalInt:Option[Int]
]]>

</script>

For versions prior to 2.9.0, when the Scala compiler encountered a
definition like the one above it would create  
java bytecode that references the primitive type. Unfortunately, doing
so resulted in technically invalid byte code and led to issues with
standard Java tools. To resolve that issue the Scala compiler from
version 2.9.0 onward replaces the primitive type with a reference to
java.lang.Object in the generated byte code, which solves the tooling
issue, but makes it very difficult to determine what the primitive type
parameter is.

The solution adopted by Squeryl and several other popular Scala
libraries is to use the scalap tool that ships with  
Scala to disassemble the Scala class and parse the type parameter
included in the generated text. For most users  
this won’t be a problem, but for some, especially those who are
developing for resource constrainted devices the 800k+  
dependency might be an issue. To account for that, Squeryl will attempt
to determine whether scalap is available  
at runtime before attempting to use it. If scalap doesn’t exist within
your classpath, there are two alternatives  
methods for defining an Option type.

1.  Use a org.squeryl.annotations.OptionType annotation to explicitly
    specify your option type parameter.
2.  Define a zero-argument constructor that intializes each Option field
    to a default Some() value

None of these methods are ideal, but they are the best available at the
moment. A full fledged Scala reflection API is slated for Scala 2.10 so
hopefully a native Scala solution for deducing Option type parameters
will become available soon!
